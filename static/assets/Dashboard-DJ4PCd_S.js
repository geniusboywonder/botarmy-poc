import{c as b,r as c,A as j,j as e,a as E,C as O,b as $}from"./index-CLYWcaHd.js";import{A as P}from"./AgentCard-BBIn2qTw.js";import{F as z,a as F}from"./folder-OxsJTqdM.js";/**
 * @license lucide-react v0.539.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const L=[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}]],q=b("file",L);/**
 * @license lucide-react v0.539.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const D=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]],U=b("info",D);/**
 * @license lucide-react v0.539.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const V=[["path",{d:"M12 16h.01",key:"1drbdi"}],["path",{d:"M12 8v4",key:"1got3b"}],["path",{d:"M15.312 2a2 2 0 0 1 1.414.586l4.688 4.688A2 2 0 0 1 22 8.688v6.624a2 2 0 0 1-.586 1.414l-4.688 4.688a2 2 0 0 1-1.414.586H8.688a2 2 0 0 1-1.414-.586l-4.688-4.688A2 2 0 0 1 2 15.312V8.688a2 2 0 0 1 .586-1.414l4.688-4.688A2 2 0 0 1 8.688 2z",key:"1fd625"}]],H=b("octagon-alert",V);/**
 * @license lucide-react v0.539.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Q=[["rect",{x:"14",y:"3",width:"5",height:"18",rx:"1",key:"kaeet6"}],["rect",{x:"5",y:"3",width:"5",height:"18",rx:"1",key:"1wsw3u"}]],J=b("pause",Q);/**
 * @license lucide-react v0.539.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const G=[["path",{d:"M5 5a2 2 0 0 1 3.008-1.728l11.997 6.998a2 2 0 0 1 .003 3.458l-12 7A2 2 0 0 1 5 19z",key:"10ikf1"}]],Y=b("play",G);/**
 * @license lucide-react v0.539.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Z=[["path",{d:"M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z",key:"1ffxy3"}],["path",{d:"m21.854 2.147-10.94 10.939",key:"12cjpa"}]],B=b("send",Z);/**
 * @license lucide-react v0.539.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const K=[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}],["path",{d:"M9.1 9a3 3 0 0 1 5.82 1c0 2-3 3-3 3",key:"mhlwft"}],["path",{d:"M12 17h.01",key:"p32p05"}]],W=b("shield-question-mark",K),X=()=>{const{agents:r,setAgents:l,loading:s,error:a,refetch:x}=c.useContext(j),n=i=>{l(r.map(m=>m.id===i?{...m,expanded:!m.expanded}:m))};return e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow border border-gray-200 dark:border-gray-700 p-4 h-full flex flex-col","data-testid":"agent-panel",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Agents"}),s.agents&&e.jsx("p",{children:"Loading agents..."}),a.agents&&e.jsxs("div",{children:[e.jsx("p",{className:"text-red-500","data-testid":"error-message",children:a.agents}),e.jsx("button",{onClick:()=>x("agents"),className:"mt-2 px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700",children:"Retry"})]}),!s.agents&&!a.agents&&e.jsx("div",{className:"space-y-4 overflow-y-auto",children:Array.isArray(r)&&r.length>0?r.map(i=>e.jsx(P,{agent:i,onToggleExpand:n},i.id)):e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"No agents available."})})]})},ee=()=>{const{tasks:r,loading:l,error:s,refetch:a}=c.useContext(j),[x,n]=c.useState({id:null,option:null});console.log("ActionQueue: tasks =",r,"type:",typeof r,"isArray:",Array.isArray(r));const i=async(d,o)=>{n({id:d,option:o});try{await E(d,o),a("tasks")}catch(f){console.error("Failed to respond to action:",f)}finally{n({id:null,option:null})}},m=d=>{switch(d){case"high":return e.jsx(H,{className:"text-red-500",size:20});case"medium":return e.jsx(W,{className:"text-yellow-500",size:20});default:return e.jsx(U,{className:"text-blue-500",size:20})}},y=Array.isArray(r)?r:[];return e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow border border-gray-200 dark:border-gray-700 p-4 h-full flex flex-col",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Action Queue"}),l.tasks&&e.jsx("p",{children:"Loading tasks..."}),s.tasks&&e.jsxs("div",{children:[e.jsx("p",{className:"text-red-500",children:s.tasks}),e.jsx("button",{onClick:()=>a("tasks"),className:"mt-2 px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700",children:"Retry"})]}),!l.tasks&&!s.tasks&&e.jsxs("div",{className:"space-y-4 overflow-y-auto",children:[y.length===0&&e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"No pending actions."}),y.map(d=>{const o={id:d.id||"unknown",title:d.title||"Untitled Task",description:d.description||"No description available",priority:d.priority||"low",options:Array.isArray(d.options)?d.options:["Approve","Reject"]};return e.jsxs("div",{className:"p-4 border rounded-lg border-gray-200 dark:border-gray-700 flex gap-4",children:[e.jsx("div",{className:"flex-shrink-0",children:m(o.priority)}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-bold text-gray-800 dark:text-gray-200",children:o.title}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-3",children:o.description}),e.jsx("div",{className:"flex flex-wrap gap-2",children:o.options.map((f,k)=>{const N=x.id===o.id&&x.option===f;return e.jsx("button",{onClick:()=>i(o.id,f),disabled:x.id===o.id,className:"px-3 py-1 text-sm bg-gray-100 dark:bg-gray-700 text-gray-800 dark:text-gray-200 rounded hover:bg-gray-200 dark:hover:bg-gray-600 disabled:opacity-50",children:N?"Submitting...":f},k)})})]})]},o.id)})]})]})},C=r=>!r||typeof r!="object"?[]:Object.entries(r).map(([l,s])=>Array.isArray(s)?{name:l,children:s.map(a=>({name:a.name||a}))}:typeof s=="object"&&s!==null?{name:l,children:C(s)}:{name:l}),S=({node:r})=>{const[l,s]=c.useState(!0),a=r.children&&r.children.length>0;return e.jsxs("li",{children:[e.jsxs("div",{onClick:()=>a&&s(!l),className:`flex items-center ${a?"cursor-pointer":""}`,"data-testid":`treeitem-${r.name}`,children:[a?e.jsxs(e.Fragment,{children:[e.jsx(O,{size:16,className:`mr-1 flex-shrink-0 transition-transform ${l?"rotate-90":""}`}),l?e.jsx(z,{size:16,className:"mr-2 flex-shrink-0 text-blue-500"}):e.jsx(F,{size:16,className:"mr-2 flex-shrink-0 text-blue-500"})]}):e.jsx(q,{size:16,className:"mr-2 ml-5 flex-shrink-0"}),e.jsx("span",{className:a?"font-medium":"",children:r.name})]}),a&&l&&e.jsx("ul",{className:"pl-6 border-l border-gray-200 dark:border-gray-700",children:r.children.map((x,n)=>e.jsx(S,{node:x},n))})]})},te=()=>{const{artifacts:r,loading:l,error:s,refetch:a}=c.useContext(j),x=C(r);return e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow border border-gray-200 dark:border-gray-700 p-4",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Project Specification"}),l.artifacts&&e.jsx("p",{children:"Loading artifacts..."}),s.artifacts&&e.jsxs("div",{children:[e.jsx("p",{className:"text-red-500",children:s.artifacts}),e.jsx("button",{onClick:()=>a("artifacts"),className:"mt-2 px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700",children:"Retry"})]}),!l.artifacts&&!s.artifacts&&(x.length>0?e.jsx("ul",{className:"font-mono text-sm",children:x.map((n,i)=>e.jsx(S,{node:n},i))}):e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"No project specification generated yet."}))]})},re=()=>{const{chatMessages:r,logs:l}=c.useContext(j),s=c.useRef(null),a=[...r,...l].sort((n,i)=>new Date(n.timestamp)-new Date(i.timestamp));c.useEffect(()=>{s.current&&(s.current.scrollTop=s.current.scrollHeight)},[a]);const x=n=>n.from_agent?e.jsxs("div",{className:"p-2 rounded bg-gray-100 dark:bg-gray-700",children:[e.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:[n.from_agent," to ",n.to_agent]}),e.jsx("p",{className:"font-mono text-sm",children:n.content.requirements||JSON.stringify(n.content)})]},n.id):e.jsx("div",{className:"p-2",children:e.jsx("p",{className:"font-mono text-xs text-green-500",children:`> ${n.message}`})},n.id);return e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow border border-gray-200 dark:border-gray-700 p-4 h-full flex flex-col",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Real-time Feed"}),e.jsx("div",{ref:s,className:"flex-1 overflow-y-auto space-y-2",children:a.map(x)})]})},se=({agents:r=[],chatHistory:l=[],onSendMessage:s,onPauseAgent:a,onResumeAgent:x,className:n=""})=>{const[i,m]=c.useState(""),[y,d]=c.useState([]),[o,f]=c.useState(!1),k=c.useRef(null),N=c.useRef(null);c.useEffect(()=>{var t;(t=N.current)==null||t.scrollIntoView({behavior:"smooth"})},[l]);const A=t=>{const h=/@(\w+)/g,u=[];let p;for(;(p=h.exec(t))!==null;){const g=p[1].toLowerCase(),w=r.find(v=>v.id.toLowerCase()===g);w&&u.push(w)}return u},_=t=>{const h=t.target.value;m(h);const u=A(h);d(u)},T=t=>{if(t.preventDefault(),!i.trim())return;const h=A(i);if(h.length===0)s({type:"system",content:i.trim(),timestamp:new Date().toISOString(),mentioned_agents:[]});else{const u=h[0];s({message_type:"user_command",content:i.trim(),target_agent:u.id,timestamp:new Date().toISOString(),mentioned_agents:h.map(p=>p.id)})}m(""),d([])},M=t=>{const h=/@(\w+)/g;return t.split(h).map((p,g)=>g%2===1&&r.find(v=>v.id.toLowerCase()===p.toLowerCase())?e.jsxs("span",{className:"bg-blue-100 dark:bg-blue-900 text-blue-800 dark:text-blue-200 px-1 rounded font-medium",children:["@",p]},g):p)},R=t=>{switch(t){case"working":return"text-yellow-500";case"idle":return"text-green-500";case"paused":return"text-red-500";case"error":return"text-red-600";default:return"text-gray-500"}},I=t=>{switch(t.type){case"user_command":return"bg-blue-50 dark:bg-blue-900/20 border-l-4 border-l-blue-500";case"agent_response":return"bg-green-50 dark:bg-green-900/20 border-l-4 border-l-green-500";case"agent_request":return"bg-yellow-50 dark:bg-yellow-900/20 border-l-4 border-l-yellow-500";case"system":return"bg-gray-50 dark:bg-gray-800 border-l-4 border-l-gray-400";case"error":return"bg-red-50 dark:bg-red-900/20 border-l-4 border-l-red-500";default:return"bg-white dark:bg-gray-700 border border-gray-200 dark:border-gray-600"}};return e.jsxs("div",{className:`flex flex-col h-full bg-white dark:bg-gray-800 rounded-lg shadow-lg ${n}`,children:[e.jsxs("div",{className:"p-4 border-b border-gray-200 dark:border-gray-600",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"Human-in-Loop Chat"}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-600 dark:text-gray-300",children:[e.jsx($,{className:"w-4 h-4"}),e.jsx("span",{children:"Use @agent mentions to direct commands"})]})]}),e.jsx("div",{className:"mt-3 flex flex-wrap gap-2",children:r.map(t=>e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:`w-2 h-2 rounded-full ${R(t.status)}`}),e.jsx("span",{className:"text-sm text-gray-600 dark:text-gray-300",children:t.id}),e.jsx("button",{onClick:()=>t.status==="paused"?x(t.id):a(t.id),className:"ml-1 p-1 hover:bg-gray-100 dark:hover:bg-gray-700 rounded text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200",title:t.status==="paused"?"Resume Agent":"Pause Agent",children:t.status==="paused"?e.jsx(Y,{className:"w-3 h-3"}):e.jsx(J,{className:"w-3 h-3"})})]},t.id))})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-4 space-y-3",children:[l.length===0?e.jsxs("div",{className:"text-center text-gray-500 dark:text-gray-400 mt-8",children:[e.jsx("div",{className:"mb-2",children:"💬"}),e.jsx("p",{className:"text-sm",children:"No messages yet. Try:"}),e.jsxs("div",{className:"mt-2 text-xs space-y-1",children:[e.jsx("p",{children:e.jsx("code",{children:"@analyst analyze the current requirements"})}),e.jsx("p",{children:e.jsx("code",{children:"@developer what are you working on?"})}),e.jsx("p",{children:e.jsx("code",{children:"@architect show me the system design"})})]})]}):l.map((t,h)=>{var u,p;return e.jsx("div",{className:`p-3 rounded-lg ${I(t)}`,children:e.jsx("div",{className:"flex items-start justify-between",children:e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[t.type==="user_command"&&e.jsx("span",{className:"text-xs font-medium text-blue-600 dark:text-blue-400",children:"YOU"}),t.type==="agent_response"&&e.jsx("span",{className:"text-xs font-medium text-green-600 dark:text-green-400",children:((u=t.fromAgent)==null?void 0:u.toUpperCase())||"AGENT"}),t.type==="agent_request"&&e.jsxs("span",{className:"text-xs font-medium text-yellow-600 dark:text-yellow-400",children:[((p=t.fromAgent)==null?void 0:p.toUpperCase())||"AGENT"," REQUESTS PERMISSION"]}),t.type==="system"&&e.jsx("span",{className:"text-xs font-medium text-gray-600 dark:text-gray-400",children:"SYSTEM"}),e.jsx("span",{className:"text-xs text-gray-400 dark:text-gray-500",children:new Date(t.timestamp).toLocaleTimeString()})]}),e.jsx("div",{className:"text-sm text-gray-800 dark:text-gray-200",children:M(t.content)}),t.type==="agent_request"&&t.awaitingPermission&&e.jsxs("div",{className:"mt-3 flex gap-2",children:[e.jsx("button",{onClick:()=>{var g;return(g=t.onApprove)==null?void 0:g.call(t,t.requestId)},className:"px-3 py-1 bg-green-500 hover:bg-green-600 text-white text-xs rounded",children:"Approve"}),e.jsx("button",{onClick:()=>{var g;return(g=t.onReject)==null?void 0:g.call(t,t.requestId)},className:"px-3 py-1 bg-red-500 hover:bg-red-600 text-white text-xs rounded",children:"Reject"}),e.jsx("button",{onClick:()=>{var g;return(g=t.onModify)==null?void 0:g.call(t,t.requestId)},className:"px-3 py-1 bg-blue-500 hover:bg-blue-600 text-white text-xs rounded",children:"Modify"})]})]})})},h)}),e.jsx("div",{ref:N})]}),e.jsxs("div",{className:"p-4 border-t border-gray-200 dark:border-gray-600",children:[y.length>0&&e.jsxs("div",{className:"mb-2 text-xs text-gray-600 dark:text-gray-400",children:["Mentioning: ",y.map(t=>e.jsxs("span",{className:"ml-1 bg-blue-100 dark:bg-blue-900 text-blue-800 dark:text-blue-200 px-1 rounded",children:["@",t.id]},t.id))]}),e.jsxs("form",{onSubmit:T,className:"flex gap-2",children:[e.jsx("input",{ref:k,type:"text",value:i,onChange:_,placeholder:"Type a message... Use @agent to mention agents",className:`flex-1 px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md 
                     bg-white dark:bg-gray-700 text-gray-900 dark:text-white
                     focus:ring-2 focus:ring-blue-500 focus:border-transparent`,disabled:o}),e.jsxs("button",{type:"submit",disabled:!i.trim()||o,className:`px-4 py-2 bg-blue-600 hover:bg-blue-700 disabled:bg-gray-400 
                     text-white rounded-md transition-colors duration-200
                     flex items-center gap-2`,children:[e.jsx(B,{className:"w-4 h-4"}),"Send"]})]}),o&&e.jsx("div",{className:"mt-2 text-xs text-gray-500 dark:text-gray-400 flex items-center gap-1",children:e.jsx("div",{className:"animate-pulse",children:"Agent is typing..."})})]})]})},le=()=>{const{agents:r}=c.useContext(j),[l,s]=c.useState([]),[a,x]=c.useState(!0);c.useEffect(()=>{n()},[]);const n=async()=>{try{const o=await(await fetch("/api/chat/history")).json();s(o.messages||[])}catch(d){console.error("Failed to fetch chat history:",d)}},i=async d=>{try{(await fetch("/api/chat/send",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(d)})).ok?n():console.error("Failed to send message")}catch(o){console.error("Error sending message:",o)}},m=async d=>{try{(await fetch("/api/agents/action",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({agent_id:d,action:"pause"})})).ok?n():console.error("Failed to pause agent")}catch(o){console.error("Error pausing agent:",o)}},y=async d=>{try{(await fetch("/api/agents/action",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({agent_id:d,action:"resume"})})).ok?n():console.error("Failed to resume agent")}catch(o){console.error("Error resuming agent:",o)}};return e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6 h-full",children:[e.jsxs("div",{className:"lg:col-span-1 flex flex-col gap-6",children:[e.jsx(X,{}),e.jsx(ee,{})]}),e.jsxs("div",{className:"lg:col-span-2",children:[a?e.jsx(se,{agents:r,chatHistory:l,onSendMessage:i,onPauseAgent:m,onResumeAgent:y,className:"h-full"}):e.jsx(re,{}),e.jsx("div",{className:"mt-4 flex justify-center",children:e.jsxs("div",{className:"bg-gray-100 dark:bg-gray-700 rounded-lg p-1 flex",children:[e.jsx("button",{onClick:()=>x(!0),className:`px-4 py-2 rounded-md text-sm font-medium transition-colors ${a?"bg-white dark:bg-gray-800 text-gray-900 dark:text-white shadow-sm":"text-gray-600 dark:text-gray-300 hover:text-gray-900 dark:hover:text-white"}`,children:"Chat"}),e.jsx("button",{onClick:()=>x(!1),className:`px-4 py-2 rounded-md text-sm font-medium transition-colors ${a?"text-gray-600 dark:text-gray-300 hover:text-gray-900 dark:hover:text-white":"bg-white dark:bg-gray-800 text-gray-900 dark:text-white shadow-sm"}`,children:"System Logs"})]})})]}),e.jsx("div",{className:"lg:col-span-3",children:e.jsx(te,{})})]})};export{le as default};
